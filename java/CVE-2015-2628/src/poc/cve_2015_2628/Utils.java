package poc.cve_2015_2628;

import java.util.Arrays;

public class Utils {

	private static int depth = 0;
	
	public static String toHexString( long l ) {
		final char[] hexChars = "0123456789ABCDEF".toCharArray( );
		final char[] chars = new char[ 16 ];
		
		Arrays.fill( chars, hexChars[ 0 ] );
		
		int index = chars.length - 1;
		while( l != 0 ) {
			chars[ index ] = hexChars[ ( int ) ( l & 0xF ) ];
			
			l >>>= 4;
			index--;
		}
		
		return new String( chars );
	}
	
	public static String toHexString( int i ) {
		return toHexString( i & 0xFFFFFFFFl ).substring( 8 );
	}
	
	public static void increaseDepth( ) {
		depth++;
	}
	
	public static void decreaseDepth( ) {
		depth--;
	}
	
	public static void logln( String format, Object... args ) {
		Utils.log( format, args );
		System.err.println( );
	}
	
	public static void log( String format, Object... args ) {
		final String msg = String.format( format, args );
		
		StringBuilder builder = new StringBuilder( );
		for( int i = 0; i < Utils.depth; i++ ) {
			builder.append( "    " );
		}
		builder.append( "- " ).append( msg );
		
		System.err.print( builder.toString( ) );
	}
	
	public static StackTraceElement getCallerFrame( ) {
		return Utils.getCallerFrame( 1 );
	}
	
	public static StackTraceElement getCallerFrame( int offset ) {
		StackTraceElement[] frames = Thread.currentThread().getStackTrace();
		
		return frames[ offset + 3 ];
	}
	
}
